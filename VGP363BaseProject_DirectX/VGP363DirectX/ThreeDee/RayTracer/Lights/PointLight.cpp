// PointLight.cpp
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "PointLight.h"

namespace ThreeD
{
	_POINTLIGHT::_POINTLIGHT(const _VERTEX4F &pos, const _COLOR4F &c, const _DOUBLE l)
		:_LIGHT(),
		location(pos),
		color(c),
		ls(l)
	{}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	_POINTLIGHT::~_POINTLIGHT() {}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	_VERTEX4F _POINTLIGHT::_GetDirection(_SHADEREC &sr)
	{
		_VERTEX4F dir = location - sr.hit_point;
		dir._Normalize();
		return (dir);
	}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	_COLOR4F _POINTLIGHT::_L(_SHADEREC &sr)
	{
		return (color * ls);
	}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	bool _POINTLIGHT::_InShadow(const _RAY &ray, const _SHADEREC &sr)
	{
		float t;
		int num_objects = sr.world_ptr->objects.size();
		_VERTEX4F lightpath = location - sr.hit_point;
		_DOUBLE d = lightpath._Magnitude();

		for(int j = 0; j < num_objects; j++)
			if(sr.world_ptr->objects[j]->_ShadowHit(ray, t) && t < d) return true;
		
		return false;
	}
}